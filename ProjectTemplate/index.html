<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
	<!--DO NOT FORGET THIS SCRIPT TAG SO YOU CAN USE JQUERY!!!!!-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!--YOUR OWN JAVASCRIPT CAN GO RIGHT HERE-->
	<script type="text/javascript">
		function TestButtonHandler() {
			var webMethod = "ProjectServices.asmx/TestConnection";
			var parameters = "{}";

			//jQuery ajax method
			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					var responseFromServer = msg.d;
					alert(responseFromServer);
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
		}

		function LogOn(userId, pass) {
			var webMethod = "AccountServices.asmx/LogOn";
			var parameters = "{\"uid\":\"" + encodeURI(userId) + "\",\"pass\":\"" + encodeURI(pass) + "\"}";

			//jQuery ajax method
			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					if (msg.d) {
						//server replied true, so show the accounts panel
						showPanel('accountsPanel');
						LoadAccounts();
					}
					else {
						//server replied false, so let the user know
						//the logon failed
						alert("logon failed");
					}
				},
				error: function (e) {
					alert("boo...");
				}
			});
		}
		var accountsArray;
		var admin = false;

		//this function grabs accounts and loads our account window
		function LoadAccounts() {
			var webMethod = "AccountServices.asmx/GetAccounts";
			$.ajax({
				type: "POST",
				url: webMethod,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					if (msg.d.length > 0) {
						//let's put our accounts that we get from the
						//server into our accountsArray variable
						//so we can use them in other functions as well
						accountsArray = msg.d;
						//this clears out the div that will hold our account info
						$("#accountsBox").empty();
						//again, we assume we're not an admin unless we see data from the server
						//that we know only admins can see
						admin = false;
						for (var i = 0; i < accountsArray.length; i++) {
							//we grab on to a specific html element in jQuery
							//by using a  # followed by that element's id.
							var acct;
							//if they have access to admin-level info (like userid and password) then
							//create output that has an edit option
							if (accountsArray[i].userId != null) {
								acct = "<div class='accountRow' id='acct" + accountsArray[i].id + "'>" +
										"<a class='nameTag' href='mailto:" + accountsArray[i].email + "'>" +
										accountsArray[i].firstName + " " + accountsArray[i].lastName +
										"</a> <a href='#' onclick='LoadAccount(" + accountsArray[i].id+")' class='optionsTag'>edit</a></div><hr>"
								admin = true;
							}
							//if not, then they're not an admin so don't include the edit option
							else {
								acct = "<div class='accountRow' id='acct" + accountsArray[i].id + "'>" +
										"<a class='nameTag' href='mailto:" + accountsArray[i].email + "'>" +
										accountsArray[i].firstName + " " + accountsArray[i].lastName +
										"</a></div><hr>"
							}
							$("#accountsBox").append(
									//anything we throw at our panel in the form of text
									//will be added to the contents of that panel.  Here
									//we're putting together a div that holds info on the
									//account as well as an edit link if the user is an admin
									acct
							);
						}
					}
					//we're showing the account window, so let's track that...
					accountWindowShowing = true;
					//...because the ShowMenu function behaves differently depending on
					//if the account window is showing or not
					ShowMenu();
				},
				error: function (e) {
					alert("boo...");
				}
			});
		}
		
	</script>
	<!--END OF YOUR OWN JAVASCRIPT-->

	<!--AND YOUR OWN CSS CAN GO HERE AS WELL-->
	<style>

	</style>
	<!--END OF YOUR OWN CSS-->
</head >
<body>
	<button onclick="javascript: TestButtonHandler();">Click here to test connection!</button>
	<div class="contentContainer">

		<div id="logonPanel" class="contentPanel logonPanel">
			<div class="logonBox">
				<form onsubmit="LogOn($('#logonId').val(), $('#logonPassword').val()); return false;">
					<div class="left">Logon</div>
					<div><a href="#" onclick="showPanel('newAccountPanel')" class="tinyLink">...or request an account</a></div>
					<hr />
					<div>
						ID: <input type="text" id="logonId" />
					</div>
					<div>
						Pwd: <input type="password" id="logonPassword" />
					</div>
					<hr />
					<div>
						<button type="submit">Go!</button>
					</div>
				</form>

			</div>
		</div>
	</div>
</body>
</html >
